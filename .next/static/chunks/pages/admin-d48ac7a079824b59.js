(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[309],{2317:(e,t,a)=>{"use strict";a.d(t,{Ah:()=>c,Bj:()=>n,DD:()=>o,DX:()=>d,Gb:()=>l,K7:()=>i,j0:()=>s,jE:()=>r});let r=async()=>{let e=await fetch("/categories",{credentials:"include"});if(!e.ok){let t=await e.text();throw Error("Failed to fetch categories: ".concat(e.status," ").concat(e.statusText," - ").concat(t))}return e.json()},s=async()=>{let e=await fetch("/products",{credentials:"include"});if(!e.ok){let t=await e.text();throw Error("Failed to fetch products: ".concat(e.status," ").concat(e.statusText," - ").concat(t))}return e.json()},c=async e=>{let t=await fetch("/categories",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({name:e})});if(!t.ok){let e=await t.text();throw Error("Failed to add category: ".concat(t.status," ").concat(t.statusText," - ").concat(e))}},n=async(e,t,a,r,s)=>{let c=new FormData;c.append("catid",e),c.append("name",t),c.append("price",a),c.append("description",r),s&&c.append("image",s);let n=await fetch("/products",{method:"POST",credentials:"include",body:c});if(!n.ok){let e=await n.text();throw Error("Failed to add product: ".concat(n.status," ").concat(n.statusText," - ").concat(e))}},i=async(e,t)=>{let a=await fetch("/categories/".concat(e),{method:"DELETE",credentials:"include"});if(!a.ok){let e=await a.text();throw Error("Failed to delete category: ".concat(a.status," ").concat(a.statusText," - ").concat(e))}t()},o=async(e,t)=>{let a=await fetch("/products/".concat(e),{method:"DELETE",credentials:"include"});if(!a.ok){let e=await a.text();throw Error("Failed to delete product: ".concat(a.status," ").concat(a.statusText," - ").concat(e))}t()},l=async()=>{let e=await fetch("/api/orders",{credentials:"include"});if(!e.ok)throw Error("Failed to fetch orders");let t=await e.json();return console.log("Raw /api/orders response:",t),t.map(e=>({id:e.id,user_id:e.user_id,total:e.total,created_at:e.created_at,payment_status:e.payment_status,items:e.items||[]}))},d=async()=>{let e=await fetch("/api/user-orders",{credentials:"include"});if(!e.ok){let t=await e.text();throw Error("Failed to fetch user orders: ".concat(e.status," ").concat(e.statusText," - ").concat(t))}let t=await e.json();return console.log("Raw /api/user-orders response:",t),t.map(e=>({id:e.id,user_id:e.user_id,total:e.total,created_at:e.created_at,payment_status:e.payment_status,items:e.items||[]}))}},4768:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin",function(){return a(4888)}])},4888:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>p});var r=a(7876),s=a(4232),c=a(9099),n=a(2317),i=a(9765),o=a(7328),l=a.n(o),d=a(8230),u=a.n(d),h=a(7245),m=a.n(h);let p=()=>{let[e,t]=(0,s.useState)([]),[a,o]=(0,s.useState)([]),[d,h]=(0,s.useState)([]),[p,x]=(0,s.useState)(!0),[g,j]=(0,s.useState)(""),f=(0,c.useRouter)();if((0,s.useEffect)(()=>{(async()=>{try{let[e,a,r]=await Promise.all([(0,n.jE)(),(0,n.j0)(),(0,n.Gb)()]);console.log("Fetched orders:",r),t(e),o(a),h(r),x(!1)}catch(e){console.error("Error fetching data:",e),j("Failed to load data: ".concat(e.message)),x(!1)}})()},[f]),p)return(0,r.jsx)("p",{children:"Loading..."});if(g)return(0,r.jsx)("p",{className:m().error,children:g});let y=async e=>{e.preventDefault();try{let a=e.currentTarget.elements.namedItem("categoryName").value;await (0,n.Ah)(a);let r=await (0,n.jE)();t(r),j("")}catch(e){j("Failed to add category: ".concat(e.message))}},w=async e=>{e.preventDefault();try{var t;let a=e.currentTarget.elements.namedItem("categorySelect").value,r=e.currentTarget.elements.namedItem("productName").value,s=e.currentTarget.elements.namedItem("productPrice").value,c=e.currentTarget.elements.namedItem("productDescription").value,i=null==(t=e.currentTarget.elements.namedItem("productImage").files)?void 0:t[0];await (0,n.Bj)(a,r,s,c,i);let l=await (0,n.j0)();o(l),j("")}catch(e){j("Failed to add product: ".concat(e.message))}},_=async e=>{try{await (0,n.K7)(e,async()=>{let e=await (0,n.jE)();t(e)}),j("")}catch(e){j("Failed to delete category: ".concat(e.message))}},N=async e=>{try{await (0,n.DD)(e,async()=>{let e=await (0,n.j0)();o(e)}),j("")}catch(e){j("Failed to delete product: ".concat(e.message))}};return(0,r.jsxs)("div",{className:m().container,children:[(0,r.jsx)(l(),{children:(0,r.jsx)("title",{children:"Admin Panel"})}),(0,r.jsx)(i.A,{}),(0,r.jsx)("h1",{children:"Admin Panel"}),g&&(0,r.jsx)("p",{className:m().error,children:g}),(0,r.jsx)("h2",{children:"Add Category"}),(0,r.jsxs)("form",{id:"categoryForm",onSubmit:y,className:m().form,children:[(0,r.jsx)("input",{type:"text",id:"categoryName",placeholder:"Category Name",required:!0,className:m().input}),(0,r.jsx)("button",{type:"submit",className:m().button,children:"Add Category"})]}),(0,r.jsx)("h2",{children:"Categories"}),(0,r.jsx)("ul",{className:m().list,children:e.map(e=>(0,r.jsxs)("li",{className:m().listItem,children:[e.name,(0,r.jsx)("button",{onClick:()=>_(e.catid),className:m().deleteButton,children:"Delete"})]},e.catid))}),(0,r.jsx)("h2",{children:"Add Product"}),(0,r.jsxs)("form",{id:"productForm",onSubmit:w,encType:"multipart/form-data",className:m().form,children:[(0,r.jsx)("select",{id:"categorySelect",className:m().input,children:e.map(e=>(0,r.jsx)("option",{value:e.catid,children:e.name},e.catid))}),(0,r.jsx)("input",{type:"text",id:"productName",placeholder:"Product Name",required:!0,className:m().input}),(0,r.jsx)("input",{type:"number",id:"productPrice",placeholder:"Price",required:!0,className:m().input}),(0,r.jsx)("textarea",{id:"productDescription",placeholder:"Description",required:!0,className:m().textarea}),(0,r.jsx)("input",{type:"file",id:"productImage",accept:"image/png, image/jpeg, image/gif",className:m().input}),(0,r.jsx)("button",{type:"submit",className:m().button,children:"Add Product"})]}),(0,r.jsx)("h2",{children:"Product List"}),(0,r.jsx)("ul",{id:"productList",className:m().list,children:a.map(e=>(0,r.jsxs)("li",{className:m().listItem,children:[(0,r.jsx)("strong",{children:e.name})," - $",e.price,(0,r.jsx)("br",{}),(0,r.jsx)("em",{children:e.description}),(0,r.jsx)("br",{}),(0,r.jsx)("img",{src:"/Uploads/".concat(e.image),width:"100",alt:e.name}),(0,r.jsx)("br",{}),(0,r.jsx)("button",{onClick:()=>N(e.pid),className:m().deleteButton,children:"Delete"})]},e.pid))}),(0,r.jsx)("h2",{children:"Orders"}),0===d.length?(0,r.jsx)("p",{children:"No orders found."}):(0,r.jsxs)("table",{className:m().orderTable,children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:"Order ID"}),(0,r.jsx)("th",{children:"user_id"}),(0,r.jsx)("th",{children:"Total"}),(0,r.jsx)("th",{children:"Products"}),(0,r.jsx)("th",{children:"Payment Status"}),(0,r.jsx)("th",{children:"Order Date"})]})}),(0,r.jsx)("tbody",{children:d.map(e=>{var t;return(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:e.id}),(0,r.jsx)("td",{children:null!=(t=e.user_id)?t:"Guest"}),(0,r.jsxs)("td",{children:["$",null!=e.total?e.total.toFixed(2):"0.00"]}),(0,r.jsx)("td",{children:(0,r.jsx)("ul",{children:e.items&&e.items.length>0?e.items.map(e=>(0,r.jsx)("li",{children:(0,r.jsxs)(u(),{href:"/product/".concat(e.pid),children:[e.name," (x",e.quantity,") - $",null!=e.price?e.price.toFixed(2):"0.00"]})},e.pid)):(0,r.jsx)("li",{children:"No items"})})}),(0,r.jsx)("td",{children:e.payment_status||"Pending"}),(0,r.jsx)("td",{children:new Date(e.created_at).toLocaleString()})]},e.id)})})]})]})}},7245:e=>{e.exports={container:"AdminPanel_container__7fkr3",form:"AdminPanel_form__h6SyK",input:"AdminPanel_input__HrxN8",textarea:"AdminPanel_textarea__XJtDi",button:"AdminPanel_button__emuPj",deleteButton:"AdminPanel_deleteButton__JfLEa",list:"AdminPanel_list__sUFAF",listItem:"AdminPanel_listItem__doz7F",orderTable:"AdminPanel_orderTable__QxYET"}},7328:(e,t,a)=>{e.exports=a(9836)},9765:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var r=a(7876),s=a(4232),c=a(8230),n=a.n(c),i=a(1040),o=a(9099);let l=()=>{let[e,t]=(0,s.useState)(null),a=(0,o.useRouter)();(0,s.useEffect)(()=>{(async()=>{if("true"===localStorage.getItem("loggedOut")){console.log("Skipping auth check due to recent logout"),t("Guest");return}try{console.log("Checking user, browser cookies:",document.cookie);let e=await i.A.get("https://s33.ierg4210.ie.cuhk.edu.hk/auth/user",{withCredentials:!0});console.log("Fetched user:",e.data);let r=localStorage.getItem("expectedUserId");if(r&&e.data.userId.toString()!==r){console.warn("User ID mismatch! Expected: ".concat(r,", Got: ").concat(e.data.userId,". Multiple authToken cookies may exist.")),await i.A.post("https://s33.ierg4210.ie.cuhk.edu.hk/auth/logout",{},{withCredentials:!0}),localStorage.setItem("loggedOut","true"),t("Guest"),a.push("/login");return}t("admin"===e.data.role?"Admin":"User")}catch(a){var e;console.error("User not authenticated:",(null==(e=a.response)?void 0:e.data)||a),t("Guest")}})()},[a]);let c=async()=>{try{console.log("Sending logout request, browser cookies:",document.cookie);let e=await i.A.post("https://s33.ierg4210.ie.cuhk.edu.hk/auth/logout",{},{withCredentials:!0});console.log("Logout response:",e.data),t("Guest"),localStorage.setItem("loggedOut","true"),localStorage.removeItem("expectedUserId"),localStorage.removeItem("lastLogin"),localStorage.removeItem("redirectAfterLogin"),document.cookie="authToken=; Path=/; Expires=Thu, 01 Jan 1970 00:00:00 GMT",document.cookie="sessionID=; Path=/; Expires=Thu, 01 Jan 1970 00:00:00 GMT",document.cookie="authToken=; Path=/auth; Expires=Thu, 01 Jan 1970 00:00:00 GMT",document.cookie="sessionID=; Path=/auth; Expires=Thu, 01 Jan 1970 00:00:00 GMT",document.cookie="authToken=; Path=/api; Expires=Thu, 01 Jan 1970 00:00:00 GMT",document.cookie="sessionID=; Path=/api; Expires=Thu, 01 Jan 1970 00:00:00 GMT",a.push("/login")}catch(t){var e;console.error("Logout failed:",(null==(e=t.response)?void 0:e.data)||t)}};return(0,r.jsx)("header",{children:(0,r.jsxs)("nav",{className:"navbar",children:[(0,r.jsxs)("ul",{children:[(0,r.jsx)("li",{children:(0,r.jsx)(n(),{href:"/",children:"Home"})}),(0,r.jsxs)("li",{className:"category",children:[(0,r.jsx)("a",{href:"#",children:"Category"}),(0,r.jsxs)("ul",{className:"cate",children:[(0,r.jsx)("li",{children:(0,r.jsx)(n(),{href:"/smartphone",children:"Smartphone"})}),(0,r.jsx)("li",{children:(0,r.jsx)(n(),{href:"/laptop",children:"Laptop"})})]})]}),(0,r.jsx)("li",{children:(0,r.jsx)(n(),{href:"/member-portal",children:"Member Portal"})}),"Admin"===e&&(0,r.jsx)("li",{children:(0,r.jsx)(n(),{href:"/admin",children:"Admin Panel"})})]}),(0,r.jsx)("div",{className:"user-actions",children:null===e?(0,r.jsx)("span",{children:"Loading..."}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("span",{className:"user-greeting",children:["Welcome, ",e]}),"Guest"!==e?(0,r.jsx)("button",{className:"logout-btn",onClick:c,children:"Logout"}):(0,r.jsx)(n(),{href:"/login",children:(0,r.jsx)("button",{className:"login-btn",children:"Login"})}),(0,r.jsx)(n(),{href:"/changepwd",children:(0,r.jsx)("button",{className:"pwd",children:"Reset"})})]})})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[846,230,636,593,792],()=>t(4768)),_N_E=e.O()}]);