(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[953],{2317:(t,e,a)=>{"use strict";a.d(e,{Ah:()=>o,Bj:()=>c,DD:()=>n,DX:()=>l,Gb:()=>d,K7:()=>i,j0:()=>s,jE:()=>r});let r=async()=>{let t=await fetch("/categories",{credentials:"include"});if(!t.ok){let e=await t.text();throw Error("Failed to fetch categories: ".concat(t.status," ").concat(t.statusText," - ").concat(e))}return t.json()},s=async()=>{let t=await fetch("/products",{credentials:"include"});if(!t.ok){let e=await t.text();throw Error("Failed to fetch products: ".concat(t.status," ").concat(t.statusText," - ").concat(e))}return t.json()},o=async t=>{let e=await fetch("/categories",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({name:t})});if(!e.ok){let t=await e.text();throw Error("Failed to add category: ".concat(e.status," ").concat(e.statusText," - ").concat(t))}},c=async(t,e,a,r,s)=>{let o=new FormData;o.append("catid",t),o.append("name",e),o.append("price",a),o.append("description",r),s&&o.append("image",s);let c=await fetch("/products",{method:"POST",credentials:"include",body:o});if(!c.ok){let t=await c.text();throw Error("Failed to add product: ".concat(c.status," ").concat(c.statusText," - ").concat(t))}},i=async(t,e)=>{let a=await fetch("/categories/".concat(t),{method:"DELETE",credentials:"include"});if(!a.ok){let t=await a.text();throw Error("Failed to delete category: ".concat(a.status," ").concat(a.statusText," - ").concat(t))}e()},n=async(t,e)=>{let a=await fetch("/products/".concat(t),{method:"DELETE",credentials:"include"});if(!a.ok){let t=await a.text();throw Error("Failed to delete product: ".concat(a.status," ").concat(a.statusText," - ").concat(t))}e()},d=async()=>{let t=await fetch("/api/orders",{credentials:"include"});if(!t.ok)throw Error("Failed to fetch orders");let e=await t.json();return console.log("Raw /api/orders response:",e),e.map(t=>({id:t.id,user_id:t.user_id,total:t.total,created_at:t.created_at,payment_status:t.payment_status,items:t.items||[]}))},l=async()=>{let t=await fetch("/api/user-orders",{credentials:"include"});if(!t.ok){let e=await t.text();throw Error("Failed to fetch user orders: ".concat(t.status," ").concat(t.statusText," - ").concat(e))}let e=await t.json();return console.log("Raw /api/user-orders response:",e),e.map(t=>({id:t.id,user_id:t.user_id,total:t.total,created_at:t.created_at,payment_status:t.payment_status,items:t.items||[]}))}},2896:(t,e,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/member-portal",function(){return a(8456)}])},7990:t=>{t.exports={"member-portal":"MemberPortal_member-portal__afGJR",container:"MemberPortal_container__hqPLZ","orders-section":"MemberPortal_orders-section__QDt_Y","cart-section":"MemberPortal_cart-section__PMEi9","orders-list":"MemberPortal_orders-list__XaThS","order-card":"MemberPortal_order-card__xAknq","cart-card":"MemberPortal_cart-card__uof9v",title:"MemberPortal_title__3zqST",subtitle:"MemberPortal_subtitle__UZPmV",subheading:"MemberPortal_subheading__6ZQ_O",text:"MemberPortal_text__VbT_j",list:"MemberPortal_list__XZZ8s","cart-empty":"MemberPortal_cart-empty__WDL7t","cart-total":"MemberPortal_cart-total__k3I0O"}},8456:(t,e,a)=>{"use strict";a.r(e),a.d(e,{default:()=>_});var r=a(7876),s=a(4232),o=a(9099),c=a(1040),i=a(2317),n=a(9765),d=a(7094),l=a(7990),u=a.n(l);let _=()=>{let[t,e]=(0,s.useState)([]),[a,l]=(0,s.useState)(!0),[_,h]=(0,s.useState)(null),p=(0,o.useRouter)();return((0,s.useEffect)(()=>{(async()=>{try{if(!(await c.A.get("https://s33.ierg4210.ie.cuhk.edu.hk/auth/user",{withCredentials:!0})).data.userId)return void p.push("/login");let t=await (0,i.DX)();e(t)}catch(e){var t;console.error("Error fetching user or orders:",(null==(t=e.response)?void 0:t.data)||e),h("Failed to load orders. Please log in again."),p.push("/login")}finally{l(!1)}})()},[p]),a)?(0,r.jsx)("div",{children:"Loading..."}):_?(0,r.jsx)("div",{children:_}):(0,r.jsxs)("div",{children:[(0,r.jsx)(n.A,{}),(0,r.jsxs)("div",{className:u()["member-portal"],children:[(0,r.jsx)("h1",{children:"Member Portal - Recent Orders"}),(0,r.jsxs)("div",{className:u().container,children:[(0,r.jsx)("div",{className:u()["orders-section"],children:0===t.length?(0,r.jsx)("p",{children:"No recent orders found."}):(0,r.jsx)("div",{className:u()["orders-list"],children:t.map(t=>(0,r.jsxs)("div",{className:u()["order-card"],children:[(0,r.jsxs)("h2",{children:["Order ID: ",t.id]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Date:"})," ",new Date(t.created_at).toLocaleDateString()]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Total:"})," $",t.total.toFixed(2)]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Payment Status:"})," ",t.payment_status]}),(0,r.jsx)("h3",{children:"Items:"}),(0,r.jsx)("ul",{children:t.items.map(t=>(0,r.jsxs)("li",{children:[t.name," - Quantity: ",t.quantity," - Price: $",t.price.toFixed(2)]},t.pid))})]},t.id))})}),(0,r.jsx)(d.A,{})]})]})]})}}},t=>{var e=e=>t(t.s=e);t.O(0,[846,230,125,764,636,593,792],()=>e(2896)),_N_E=t.O()}]);