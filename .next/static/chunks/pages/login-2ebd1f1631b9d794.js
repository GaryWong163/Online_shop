(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[295],{2982:(e,o,t)=>{"use strict";t.r(o),t.d(o,{default:()=>r});var s=t(7876),n=t(4232),a=t(9099);let r=()=>{let[e,o]=(0,n.useState)(""),[t,r]=(0,n.useState)(""),[i,u]=(0,n.useState)(""),l=(0,a.useRouter)(),c=async o=>{o.preventDefault(),u("");try{console.log("Browser cookies before login:",document.cookie),document.cookie="authToken=; Path=/; Expires=Thu, 01 Jan 1970 00:00:00 GMT",document.cookie="sessionID=; Path=/; Expires=Thu, 01 Jan 1970 00:00:00 GMT",document.cookie="authToken=; Path=/auth; Expires=Thu, 01 Jan 1970 00:00:00 GMT",document.cookie="sessionID=; Path=/auth; Expires=Thu, 01 Jan 1970 00:00:00 GMT",document.cookie="authToken=; Path=/api; Expires=Thu, 01 Jan 1970 00:00:00 GMT",document.cookie="sessionID=; Path=/api; Expires=Thu, 01 Jan 1970 00:00:00 GMT",console.log("Sending login request:",{email:e});let o=await fetch("https://s33.ierg4210.ie.cuhk.edu.hk/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:e,password:t})});if(console.log("Login response:",{status:o.status,headers:Object.fromEntries(o.headers.entries()),ok:o.ok}),o.ok){let e=await o.json();console.log("Login successful:",e);let t=await fetch("https://s33.ierg4210.ie.cuhk.edu.hk/auth/user",{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(t.ok){let e=await t.json();localStorage.setItem("expectedUserId",e.userId.toString()),console.log("Stored expected userId:",e.userId)}localStorage.removeItem("loggedOut"),l.push("admin"===e.role?"/admin":"/")}else{let e=await o.json();console.error("Login failed:",e),u(e.error||"Login failed")}}catch(e){console.error("Login error:",e),u("System error. Please try again later.")}};return(0,s.jsxs)("div",{className:"login-container",children:[(0,s.jsx)("h2",{children:"Login"}),i&&(0,s.jsx)("p",{className:"error",children:i}),(0,s.jsxs)("form",{onSubmit:c,children:[(0,s.jsx)("input",{type:"email",placeholder:"Email",value:e,onChange:e=>o(e.target.value),required:!0}),(0,s.jsx)("input",{type:"password",placeholder:"Password",value:t,onChange:e=>r(e.target.value),required:!0}),(0,s.jsx)("button",{type:"submit",children:"Login"})]}),(0,s.jsx)("button",{onClick:()=>l.push("/changepwd"),className:"reset-button",children:"Reset Password"}),(0,s.jsxs)("p",{children:["Don't have an account?"," ",(0,s.jsx)("a",{href:"/signup",onClick:()=>l.push("/signup"),children:"Sign Up"})]})]})}},7984:(e,o,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/login",function(){return t(2982)}])},9099:(e,o,t)=>{e.exports=t(8253)}},e=>{var o=o=>e(e.s=o);e.O(0,[636,593,792],()=>o(7984)),_N_E=e.O()}]);